---
import { SITE } from '~/config.mjs';
---

<script is:inline define:vars={{ defaultTheme: SITE.defaultTheme }}>
  function applyTheme(theme) {
    document.documentElement.classList.toggle('dark', theme === 'dark');
  }

  function toggleMenu() {
    const menuToggle = document.querySelector('[data-aw-toggle-menu]');
    if (!menuToggle) return;
    menuToggle.classList.toggle('expanded');
    document.body.classList.toggle('overflow-hidden');
    document.getElementById('header')?.classList.toggle('h-screen');
    document.getElementById('gradient')?.classList.toggle('hidden');
    document.querySelector('#header nav')?.classList.toggle('hidden');
  }

  function toggleColorScheme() {
    if (defaultTheme.endsWith(':only')) return;
    document.documentElement.classList.toggle('dark');
    localStorage.theme = document.documentElement.classList.contains('dark') ? 'dark' : 'light';
  }

  function socialShare(e) {
    const elem = e.target.closest('[data-aw-social-share]');
    if (!elem) return;

    const network = elem.getAttribute('data-aw-social-share');
    const url = encodeURIComponent(elem.getAttribute('data-aw-url'));
    const text = encodeURIComponent(elem.getAttribute('data-aw-text'));

    let href;
    switch (network) {
      case 'facebook':
        href = `https://www.facebook.com/sharer.php?u=${url}`;
        break;
      case 'twitter':
        href = `https://twitter.com/intent/tweet?url=${url}&text=${text}`;
        break;
      case 'linkedin':
        href = `https://www.linkedin.com/shareArticle?mini=true&url=${url}&title=${text}`;
        break;
      case 'whatsapp':
        href = `https://wa.me/?text=${text}%20${url}`;
        break;
      case 'mail':
        href = `mailto:?subject=%22${text}%22&body=${text}%20${url}`;
        break;
      default:
        return;
    }

    const link = document.createElement('a');
    link.target = '_blank';
    link.href = href;
    link.click();
  }

  function applyHeaderStylesOnScroll() {
    const header = document.getElementById('header');
    header?.classList.toggle('scroll', window.scrollY > 60);
  }

  function attachEvent(selector, event, fn) {
    const matches = typeof selector === 'string' ? document.querySelectorAll(selector) : selector;
    if (matches && matches.length) {
      matches.forEach((elem) => {
        elem.addEventListener(event, (e) => fn(e, elem), false);
      });
    }
  }

  function init() {
    applyTheme(defaultTheme.endsWith(':only') ? defaultTheme.replace(':only', '') : localStorage.theme || 'light');

    attachEvent('[data-aw-toggle-menu]', 'click', toggleMenu);
    attachEvent('[data-aw-toggle-color-scheme]', 'click', toggleColorScheme);
    attachEvent('[data-aw-social-share]', 'click', socialShare);
    attachEvent(document, 'scroll', () => window.requestAnimationFrame(applyHeaderStylesOnScroll));
  }

  window.addEventListener('load', init);
  window.addEventListener('pageshow', () => {
    document.documentElement.classList.add('motion-safe:scroll-smooth');
    toggleMenu();
    document.getElementById('header')?.classList.remove('h-screen');
    document.querySelector('#header nav')?.classList.add('hidden');
    document.body.classList.remove('overflow-hidden');
  });
</script>
